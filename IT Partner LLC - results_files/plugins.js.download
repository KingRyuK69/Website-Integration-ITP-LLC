(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t){return o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},o(e,t)}function i(e){return i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},i(e)}var u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&o(e,t)}(a,e);var t,u,c,f,l=(c=a,f=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=i(c);if(f){var r=i(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===n(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),l.call(this,"Time Delay")}return t=a,(u=[{key:"init",value:function(e,t){return e.settings.TypingDelay=1e3*e.request.pluginParameters.delay,e.executeBackgroundWork((function(e){e.resolve()})).done(t),e.hideTyping(),null}}])&&r(t.prototype,u),Object.defineProperty(t,"prototype",{writable:!1}),a}(function(){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t(this,"name",void 0),t(this,"eventDispatcher",void 0),this.name=e}var r,o;return r=n,(o=[{key:"setEnvironment",value:function(e){!function(e){e.$,e.rokoType,e.utils,e.moment,e.rokoAPI,e.webhooks,e.contextApi}(e)}},{key:"buildHistoryNode",value:function(e,t){var n=e.renderRequest();return n.isEmpty?null:n.htmlElement}}])&&e(r.prototype,o),Object.defineProperty(r,"prototype",{writable:!1}),n}());RokoInstabot.registerPlugin(new u)})();
(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var n,r,o=function(){function o(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),t(this,"name",void 0),t(this,"eventDispatcher",void 0),this.name=e}var i,a;return i=o,(a=[{key:"setEnvironment",value:function(e){!function(e){n=e.$,r=e.rokoType,e.utils,e.moment,e.rokoAPI,e.webhooks,e.contextApi}(e)}},{key:"buildHistoryNode",value:function(e,t){var n=e.renderRequest();return n.isEmpty?null:n.htmlElement}}])&&e(i.prototype,a),Object.defineProperty(i,"prototype",{writable:!1}),o}();function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(){function e(t,r){c(this,e),f(this,"element",void 0),f(this,"wrap",void 0),f(this,"params",void 0),this.params=r,this.element=n(t),this._render()}return l(e,[{key:"disabled",value:function(){var e=this.params;return"function"==typeof e.disabled?e.disabled():e.disabled}},{key:"_render",value:function(){var e=this;this.element.attr("tabindex",r.TabOrder.Default).addClass("actions-container"),this.wrap=n("<div>").addClass("wrap").appendTo(this.element);var t=n("<div>").addClass("action").attr("tabindex",r.TabOrder.Default).click((function(){return e.disabled()||(t.addClass("selected"),e.params.onSelectOption()),!1})).append(n("<span>").addClass("icon")).append(n("<span>").text(this.params.userDeclinesOption)).appendTo(this.wrap)}}]),e}(),d=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(u,e);var t,r,o=(t=u,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=s(t);if(r){var o=s(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return function(e,t){if(t&&("object"===i(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function u(){return c(this,u),o.call(this,"HumanTakeoverPlugin")}return l(u,[{key:"init",value:function(e,t){var r=this,o=n.Deferred(),i=n("<div>"),a=e.request.pluginParameters,s=e.request.actions[0],c=e.request.actions[1],u=!1,l=e.request.actions[2];l&&(this.eventDispatcher.on("before-freeze",(function(n){n.nonFreezable=!0,e.selectAction(l),r.eventDispatcher.off("before-freeze"),r.eventDispatcher.off("prepare-live-chat"),t()})),this.eventDispatcher.on("prepare-live-chat",(function(e){e.nonFreezable=!0})),this.eventDispatcher.on("widget-closed",(function(){r.eventDispatcher.off("before-freeze"),r.eventDispatcher.off("prepare-live-chat")})));var f=e.request._runtime;if(null!=f&&f.clientOnly&&f.isLiveChat)return e.hideTyping(),o.resolve(),o.promise();var d=window.setTimeout((function(){e.hideTyping(),e.selectAction(c),t()}),1e3*parseInt(a.TimeExpiresSeconds));return a.UserDeclinesOption&&new p(i,{userDeclinesOption:a.UserDeclinesOption,onSelectOption:function(){if(u)return!1;e.hideTyping(),window.clearTimeout(d),e.setResult({value:a.UserDeclinesOption,renderResponse:!0}),e.selectAction(s),r.eventDispatcher.off("before-freeze"),r.eventDispatcher.off("prepare-live-chat"),t()}}),e.widget.setCurrentNodeComponent({disable:function(){u||(u=!0,i.addClass("passed"),e.hideTyping(),window.clearTimeout(d))}}),e.executeBackgroundWork((function(e){return e.resolve()})).done((function(){e.selectAction(c),e.api.processGoal(),e.ui.renderRequest(i,!0,{css:"type-3"}),e.showTyping(),o.resolve()})),o.promise()}},{key:"buildHistoryNode",value:function(e,t){var r=n("<div>");return new p(r,{userDeclinesOption:t.question.node.pluginParameters.UserDeclinesOption,disabled:!0}),e.renderRequest(r,!1,{css:"type-3"}).htmlElement}}]),u}(o);RokoInstabot.registerPlugin(new d)})();
